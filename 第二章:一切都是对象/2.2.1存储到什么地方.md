## 2.2.1 存储到什么地方

- 程序运行时，对象是怎么进行放置安排的呢？特别是内存是怎样分配的呢？对这些方面的了解会对你有很大的帮助。有五个不同的地方可以存储数据：

- **1）寄存器**。这是最快的存储区，因为它位于不同于其他存储区的地方——处理器内部。但是**寄存器的数量极其有限，所以寄存器根据需求进行分配。你不能直接控制，也不能在程序中感觉到寄存器存在的任何迹象**（另一方面，C和C++元许您向编译器建议寄存器的分配方式）。

- **2) 堆栈**。位于通用RAM(随机访问存储器）中，但通过堆栈指针可以从处理器那里获得直接支持。堆栈指针若向下移动，则分配新的内存，若向上移动，则释放那些内存。这是一种快速有效的分配存储方法，仅次于奇存器。创建程序时，Java系统必须知道存储在堆栈内所有项的确切生命周期，以便上下移动堆栈指针。这一约束限制了程序的灵活性，所以虽然某些Java数据存储于堆栈中--特别是对象引用，但是Java对象并不存储于其中。

- **3) 堆**。一种通用的内存池（也位于RAM区），**用于存旅所有的Java对象**。堆不同于堆栈的好处是：编译器不需要知道存储的数据在堆里存活多长时间。因此，在堆里分配存储有很大的灵活性。当需要一个对象时，只需用new写一行简单的代码，当执行这行代码时，会自动在堆里进行存储分配。当然，为这种灵活性必须要付出相应的代价：用堆进行存储分配和清理可能比用堆栈进行存储分配需要更多的时间（如果确实可以在Java中像在C++中一样在栈中创建对象）。

- **4） 常量存储**。**常量值通常直接存放在程序代码内部，这样做是安全的，因为它们永远不会被改变**。有时，在联人式系统中，常量本身会和其他部分隔离开，所以在这种情况下，可以选择将其存放在ROM（只读存備器）中日。

- **5）非RAM存储**。如果数据完全存活手程序之外，那么它可以不受程序的任何控制，在程序没有运行时也可以存在。其中两个基本的例子是**流对象和持久化对象**。在流对象中，对象转化成字节流，通常被发送给另一台机器。在“持久化对象”中，对象被存放于磁热上，因此，即使程序终止，它们仍可以保持自己的状态。这种存储方式的技巧在于：把对象转化成可以存放在其他媒介上的事物，在需要时，可恢复成常规的、基于RAM的对象。Java提供了对轻量级持久化的支持，而诸如JDBC和Hibernate这样的机制提供了更加复杂的对在数据库中存储和读取对象信,息的支持。

## 小结
- 一切都被视为对象，这样就不必考虑对象和基本类型之间的区别。但是，这并不是说一切都是对象，因为引用并不是对象，它只是对象的一个“列用”。
- 一个程序运行时所产生的所有对象都只存储于堆内存之中，而绝不会存储于栈内存之中。但是，引用存储于栈内存中，而不存储于堆内存中。
- Java中的数组是对象，因此，当创建一个数组时，实际上就是在向堆中分配一块足够大的存储区域。与C++不同，Java会检查数组索引是否越界，这样就不会发生内存越界错误。
- Java中的数组可以动态地创建，因此，可以在运行时创建数组。但是，数组一旦被创建，就不能再改变它的大小。如果想改变数组的大小，就必须创建一个新数组，然后将原来的数组元素复制到新数组中。
- 操作的是引用，而非对象。因此，如果想操纵对象，就必须获得指向它的引用。但是，如果想操纵引用，就必须获得指向它的引用的引用。这一点将在第4章中详细讨论。